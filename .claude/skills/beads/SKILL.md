---
name: beads
description: Manage issues using the beads CLI (bd). Use when adding issues, updating status, marking items done, listing by label/status, or tracking work items.
allowed-tools: Bash(bd:*)
---

# Managing Issues with Beads

## IMPORTANT: Never Edit .beads/ Directly

**DO NOT use the Edit or Write tools to modify files in `.beads/`.** Always use the `bd` CLI commands. The database and JSONL files are managed automatically.

## Quick Reference

```bash
# Find available work
bd ready                              # Unblocked tasks ready to work on
bd ready --json                       # JSON output for scripting

# List and filter issues
bd list                               # All open issues
bd list --status closed               # Closed issues
bd list --label API                   # Filter by category label
bd list --label size-s                # Filter by effort
bd list --json                        # JSON output

# Create issues
bd create "[UI-NNN] Description" -t task -p 1 -l UI,size-m
bd create "[API-NNN] Description" -t task -p 0 -l API,size-s

# Update issues
bd update VSS-abc --status in_progress
bd update VSS-abc --priority 0
bd label add VSS-abc size-l           # Add label
bd label remove VSS-abc size-m        # Remove label

# Close issues
bd close VSS-abc --reason "PR: https://github.com/org/repo/pull/99"
bd close VSS-abc --reason "Fixed in commit abc123"

# Show issue details
bd show VSS-abc                       # Human-readable
bd show VSS-abc --json                # JSON output

# Add comments (for commit/PR links)
bd comments add VSS-abc "Commit: https://github.com/.../commit/abc123"
bd comments add VSS-abc "PR: https://github.com/.../pull/99"
bd comments VSS-abc                   # View all comments

# ⚠️ NOTE: Uses subcommand 'add', NOT flag syntax
# CORRECT:   bd comments add <id> "message"
# INCORRECT: bd comments <id> --add "message"
```

## Convention Mappings

### Categories (Labels)
| Label | Description |
|-------|-------------|
| `UI` | Frontend/web UI items |
| `API` | Backend API items |
| `INFRA` | Infrastructure/Docker/deployment |
| `TOOLS` | Development tooling/scripts |
| `CICD` | CI/CD pipeline items |
| `RETRO` | Retrospective action items (3-tier: Epic → Retro → Action Items) |

### Effort Sizing (Labels)
| Label | Description |
|-------|-------------|
| `size-s` | Small (less than 1 hour) |
| `size-m` | Medium (1-4 hours) |
| `size-l` | Large (4+ hours) |

### Priority (Numeric)
| Value | Meaning |
|-------|---------|
| `0` | High - Impacts usability or correctness |
| `1` | Medium - Noticeable improvement |
| `2` | Low - Nice-to-have |

### Status
| Status | Description |
|--------|-------------|
| `open` | Not started |
| `in_progress` | Currently being worked on |
| `closed` | Completed |

### ID Convention

**Two ID systems coexist:**

1. **Beads ID** (e.g., `VSS-abc`): Auto-generated by beads, used for all `bd` commands
2. **Legacy ID** (e.g., `[UI-029]`): Preserved in issue titles from the pre-beads polish backlog

When referencing issues:
- Use the **beads ID** (`VSS-abc`) for `bd update`, `bd close`, etc.
- Use the **legacy ID** (`[UI-029]`) to find issues by category sequence

Example title: `[UI-029] Fix button alignment` - the beads ID might be `VSS-x7k`

## Common Workflows

### Discovering an Issue During Development

```bash
# Add to backlog instead of fixing immediately
bd create "[UI-045] Button alignment off on mobile" -t task -p 2 -l UI,size-s
```

### Starting Work on an Issue

```bash
# Find something to work on
bd ready

# Mark as in-progress
bd update VSS-abc --status in_progress
```

### Memorializing Commits and PRs

When working on an issue, **always add comments** linking to commits and pull requests. This creates a traceable history of the work:

```bash
# Add commit link as comment
bd comments add VSS-abc "Commit: https://github.com/craquehouse/vintagestory-server/commit/abc123f"

# Add PR link as comment
bd comments add VSS-abc "PR: https://github.com/craquehouse/vintagestory-server/pull/99"

# View comments on an issue
bd comments VSS-abc

# ⚠️ IMPORTANT: 'comments add' uses subcommand syntax, not flags
# CORRECT:   bd comments add <id> "message"
# INCORRECT: bd comments <id> --add "message"
```

**Best practices:**
- Add a commit comment after each significant commit related to the issue
- Add the PR comment when opening a pull request
- Include brief context if helpful: `"Fix: https://github.com/.../commit/abc123 - resolved null pointer issue"`

### After Action Reports (AAR)

When closing beads, **add a comprehensive After Action Report (AAR)** as a comment. This provides better documentation than just commit links and helps with future reference.

#### Full AAR Template

Use this for non-trivial beads (size-m, size-l, or anything with interesting technical decisions):

```bash
bd comments add VSS-abc "$(cat <<'EOF'
## After Action Report

### Summary
[Brief 1-2 sentence summary of what was accomplished]

### Work Completed
- [Major items completed]
- [Include test counts, features added, etc.]

### Test Coverage
**Total Tests:** [X tests]

**Coverage Areas:**
- [Area 1]: X tests - [scenarios covered]
- [Area 2]: X tests - [scenarios covered]

### Files Created/Modified
**Created:**
- \`path/to/file1\` (X lines)

**Modified:**
- \`path/to/file2\` (added X lines)

### Technical Decisions & Notes
- [Decision 1 and rationale]
- [Notable implementation details]

### Challenges Encountered
- [Challenge and how resolved]
- None [if no significant challenges]

### Quality Verification
- [✓] All tests passing
- [✓] Code follows project conventions
- [✓] No linting errors

### Links
- Commit: https://github.com/org/repo/commit/[hash]

### Follow-up Items
- [Any follow-up work identified]
- None [if no follow-ups]
EOF
)"
```

#### Abbreviated AAR Template

Use this for simple beads (size-s with no challenges):

```bash
bd comments add VSS-abc "$(cat <<'EOF'
## AAR

**Summary:** Added comprehensive tests for use-debounce hook
**Tests:** 20 tests covering default/custom delays, rapid changes, cleanup
**Files:** Created \`web/src/hooks/use-debounce.test.tsx\` (358 lines)
**Commit:** https://github.com/craquehouse/vintagestory-server/commit/abc123
**Status:** ✓ All tests passing, no issues
EOF
)"
```

#### AAR Example

```bash
bd comments add VSS-029.2 "$(cat <<'EOF'
## After Action Report

### Summary
Added comprehensive test suite for api/config module covering all 7 configuration API functions.

### Work Completed
- Implemented 32 tests for api/config.ts
- Covered all CRUD operations for game and API settings
- Tested URL encoding, parameter handling, error propagation

### Test Coverage
**Total Tests:** 32 tests

**Coverage Areas:**
- fetchGameConfig: 3 tests - endpoint, data structure, errors
- updateGameSetting: 6 tests - POST method, URL encoding, value types
- fetchApiSettings: 3 tests - endpoint, data structure, errors
- updateApiSetting: 4 tests - POST method, URL encoding, value types
- fetchConfigDirectories: 5 tests - parameters, encoding, edge cases
- fetchConfigFiles: 5 tests - parameters, encoding, edge cases
- fetchConfigFileContent: 5 tests - filename encoding, JSON parsing
- API consistency: 1 test - prefix verification

### Files Created/Modified
**Created:**
- \`web/src/api/config.test.ts\` (605 lines)

**Modified:**
- None

### Technical Decisions & Notes
- Used vi.mock() to mock apiClient for isolated unit testing
- Tested URL encoding extensively due to security implications
- Verified all value types (string, number, boolean) for settings
- Added API prefix consistency test to catch refactoring issues

### Challenges Encountered
- None - straightforward API wrapper testing

### Quality Verification
- [✓] All 32 tests passing
- [✓] Code follows project test patterns
- [✓] No linting errors
- [✓] Mock setup consistent with other test files

### Links
- Commit: https://github.com/craquehouse/vintagestory-server/commit/565cfb1

### Follow-up Items
- None
EOF
)"
```

**Best practices:**
- Write AAR **before** closing the bead (while context is fresh)
- Be specific about test coverage and technical decisions
- Document "why" not just "what"
- Note challenges to help others avoid same issues
- Keep it scannable - use bullet points and clear sections
- For batch work (multiple beads), write one AAR and link it to all related beads

### Completing an Issue

```bash
# 1. Add comprehensive AAR comment (see AAR template above)
bd comments add VSS-abc "$(cat <<'EOF'
## AAR
[Your AAR content here]
EOF
)"

# 2. Close with descriptive reason
bd close VSS-abc --reason "Added comprehensive test suite - 32 tests, all passing"

# For batch closures (multiple related beads):
bd close VSS-abc VSS-def VSS-ghi --reason "Batch: Added test suites for 5 utility modules"
```

### Finding Next ID for a Category

To maintain the legacy ID sequence when creating new issues:

```bash
# Find highest existing ID for a category
bd list --label UI --json | jq -r '.[].title' | grep -o '\[UI-[0-9]*\]' | sort -t- -k2 -n | tail -1
```

### Reviewing Available Work

```bash
# High priority items
bd list --json | jq '.[] | select(.priority == 0)'

# API items that are open
bd list --label API --status open

# What's currently in progress
bd list --status in_progress
```

## Create Command Details

```bash
bd create "<title>" -t <type> -p <priority> -l <labels>
```

- **title** (required): Include `[CATEGORY-NNN]` prefix for tracking
- **-t type** (required): Usually `task`
- **-p priority** (required): 0 (high), 1 (medium), or 2 (low)
- **-l labels** (optional): Comma-separated labels (category, effort)

Examples:

```bash
# Minimal
bd create "[API-016] Add pagination" -t task -p 1

# With category and effort labels
bd create "[UI-046] Fix tooltip positioning" -t task -p 2 -l UI,size-s

# High priority with notes in description
bd create "[INFRA-008] Add health check retries" -t task -p 0 -l INFRA,size-m
```

## File Location

Beads data is stored in `.beads/`:

**Committed to git:**
- `issues.jsonl` - All issue data (source of truth)
- `config.yaml` - Repository configuration
- `README.md` - Beads documentation

**Gitignored (local only):**
- `beads.db`, `beads.db-shm`, `beads.db-wal` - SQLite cache
- `daemon.log`, `daemon.pid`, `daemon.lock`, `bd.sock` - Daemon runtime
- `.local_version` - Version tracking

## Migration Note

This project migrated from `polish-backlog.md` (markdown tables) to beads on 2026-01-18.
- All 69 items (47 active + 22 archived) were migrated with preserved IDs
- Legacy commands (`just polish`) are no longer available
- The archived file is at `_bmad-output/implementation-artifacts/polish-backlog.md.archived`
